(self.webpackChunkcms_strapi_shopping=self.webpackChunkcms_strapi_shopping||[]).push([[6719],{4191:(C,L,s)=>{var e=s(87864),a=s(86386),o=s(45353),d=s(29884),h=s(74565),u=s(52689),y=s(48126),R=s(82388),T=s(82261);function v(j,A,E){A.length?A=e(A,function(M){return T(M)?function(N){return a(N,M.length===1?M[0]:M)}:M}):A=[R];var B=-1;A=e(A,u(o));var P=d(j,function(M,N,Q){var $=e(A,function(S){return S(M)});return{criteria:$,index:++B,value:M}});return h(P,function(M,N){return y(M,N,E)})}C.exports=v},6223:(C,L,s)=>{var e=s(60759),a=s(39226),o=s(56793),d=a(function(h,u){return o(h)?e(h,u):[]});C.exports=d},29884:(C,L,s)=>{var e=s(97449),a=s(91522);function o(d,h){var u=-1,y=a(d)?Array(d.length):[];return e(d,function(R,T,v){y[++u]=h(R,T,v)}),y}C.exports=o},34542:(C,L,s)=>{var e=s(87864),a=s(45353),o=s(29884),d=s(82261);function h(u,y){var R=d(u)?e:o;return R(u,a(y,3))}C.exports=h},45635:(C,L,s)=>{var e=s(87212),a=s(4191),o=s(39226),d=s(3956),h=o(function(u,y){if(u==null)return[];var R=y.length;return R>1&&d(u,y[0],y[1])?y=[]:R>2&&d(y[0],y[1],y[2])&&(y=[y[0]]),a(u,e(y,1),[])});C.exports=h},48126:(C,L,s)=>{var e=s(64958);function a(o,d,h){for(var u=-1,y=o.criteria,R=d.criteria,T=y.length,v=h.length;++u<T;){var j=e(y[u],R[u]);if(j){if(u>=v)return j;var A=h[u];return j*(A=="desc"?-1:1)}}return o.index-d.index}C.exports=a},55379:(C,L,s)=>{"use strict";s.r(L),s.d(L,{default:()=>Ds});var e=s(92132),a=s(21272),o=s(1433),d=s(93884),h=s(69224),u=s(4655),y=s(49436),R=s(36531),T=s(36726),v=s(82869),j=s(44940),A=s(52724),E=s(12248),B=s(37750),P=s(23859),M=s(42256),N=s(92274),Q=s(54514),$=s(2506),S=s(54894),K=s(33544),O=s.n(K);const ne=(0,a.createContext)({}),oe=({children:t,value:r})=>(0,e.jsx)(ne.Provider,{value:r,children:t}),Z=()=>(0,a.useContext)(ne);oe.propTypes={children:O().node.isRequired,value:O().object.isRequired};var z=s(97552),ve=s(60508),Ce=s(88724),Ee=s(13891),Te=s(39404),De=s.n(Te);function be(t){switch(t){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return De()(t.replace("api::","").replace("plugin::",""))}}const Le=be,Pe=(t,r)=>{const n=Object.keys(r).sort().map(i=>({name:i,isOpen:!1}));return{...t,collapses:n}};var Me=s(45635),re=s.n(Me),ie=s(45564),ae=s(33340),Se=s(20415),Oe=s(2600),X=s.n(Oe),Y=s(16333);const le=(0,Y.AH)`
  background: ${t=>t.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Ue=(0,Y.Ay)(A.a)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${t=>t.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${t=>t.isActive&&le}
  &:hover {
    ${le}
  }
`,Be=Y.Ay.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,ce=({subCategory:t})=>{const{formatMessage:r}=(0,S.A)(),{onChange:n,onChangeSelectAll:i,onSelectedAction:g,selectedAction:l,modifiedData:p}=Z(),f=(0,a.useMemo)(()=>X()(p,t.name,{}),[p,t]),x=(0,a.useMemo)(()=>Object.values(f).every(c=>c.enabled===!0),[f]),m=(0,a.useMemo)(()=>Object.values(f).some(c=>c.enabled===!0)&&!x,[f,x]),b=(0,a.useCallback)(({target:{name:c}})=>{i({target:{name:c,value:!x}})},[x,i]),D=(0,a.useCallback)(c=>l===c,[l]);return(0,e.jsxs)(A.a,{children:[(0,e.jsxs)(j.s,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(A.a,{paddingRight:4,children:(0,e.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:t.label})}),(0,e.jsx)(Be,{}),(0,e.jsx)(A.a,{paddingLeft:4,children:(0,e.jsx)(ie.S,{name:t.name,value:x,onValueChange:c=>b({target:{name:t.name,value:c}}),indeterminate:m,children:r({id:"app.utils.select-all",defaultMessage:"Select all"})})})]}),(0,e.jsx)(j.s,{paddingTop:6,paddingBottom:6,children:(0,e.jsx)(B.x,{gap:2,style:{flex:1},children:t.actions.map(c=>{const G=`${c.name}.enabled`;return(0,e.jsx)(P.E,{col:6,children:(0,e.jsxs)(Ue,{isActive:D(c.name),padding:2,hasRadius:!0,children:[(0,e.jsx)(ie.S,{value:X()(p,G,!1),name:G,onValueChange:I=>n({target:{name:G,value:I}}),children:c.label}),(0,e.jsxs)("button",{type:"button",onClick:()=>g(c.name),style:{display:"inline-flex",alignItems:"center"},children:[(0,e.jsx)(ae.s,{as:"span",children:r({id:"app.utils.show-bound-route",defaultMessage:"Show bound route for {route}"},{route:c.name})}),(0,e.jsx)(Se.A,{})]})]})},c.name)})})})]})};ce.propTypes={subCategory:O().object.isRequired};const Ne=ce,de=({name:t,permissions:r})=>{const n=(0,a.useMemo)(()=>re()(Object.values(r.controllers).reduce((i,g,l)=>{const p=`${t}.controllers.${Object.keys(r.controllers)[l]}`,f=re()(Object.keys(g).reduce((x,m)=>[...x,{...g[m],label:m,name:`${p}.${m}`}],[]),"label");return[...i,{actions:f,label:Object.keys(r.controllers)[l],name:p}]},[]),"label"),[t,r]);return(0,e.jsx)(A.a,{padding:6,children:n.map(i=>(0,e.jsx)(Ne,{subCategory:i},i.name))})};de.propTypes={name:O().string.isRequired,permissions:O().object.isRequired};const $e=de;var q=s(88761);const Ge={collapses:[]},Fe=(t,r)=>(0,q.Ay)(t,n=>{switch(r.type){case"TOGGLE_COLLAPSE":{n.collapses=t.collapses.map((i,g)=>g===r.index?{...i,isOpen:!i.isOpen}:{...i,isOpen:!1});break}default:return n}}),Ie=()=>{const{modifiedData:t}=Z(),{formatMessage:r}=(0,S.A)(),[{collapses:n},i]=(0,a.useReducer)(Fe,Ge,l=>Pe(l,t)),g=l=>i({type:"TOGGLE_COLLAPSE",index:l});return(0,e.jsx)(j.s,{direction:"column",alignItems:"stretch",gap:1,children:n.map((l,p)=>(0,e.jsxs)(ve.n,{expanded:l.isOpen,onToggle:()=>g(p),variant:p%2===0?"secondary":void 0,children:[(0,e.jsx)(Ce.P,{title:Le(l.name),description:r({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:l.name}),variant:p%2?"primary":"secondary"}),(0,e.jsx)(Ee.u,{children:(0,e.jsx)(A.a,{children:(0,e.jsx)($e,{permissions:t[l.name],name:l.name})})})]},l.name))})};var We=s(77965),ke=s.n(We),Ve=s(6223),He=s.n(Ve),Je=s(34542),ze=s.n(Je),Qe=s(61468),Ke=s.n(Qe);const Xe=t=>{switch(t){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Ye=(0,Y.Ay)(A.a)`
  margin: -1px;
  border-radius: ${({theme:t})=>t.spaces[1]} 0 0 ${({theme:t})=>t.spaces[1]};
`;function _({route:t}){const{formatMessage:r}=(0,S.A)(),{method:n,handler:i,path:g}=t,l=g?Ke()(g.split("/")):[],[p="",f=""]=i?i.split("."):[],x=Xe(t.method);return(0,e.jsxs)(j.s,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsxs)(E.o,{variant:"delta",as:"h3",children:[r({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",(0,e.jsx)("span",{children:p}),(0,e.jsxs)(E.o,{variant:"delta",textColor:"primary600",children:[".",f]})]}),(0,e.jsxs)(j.s,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0,children:[(0,e.jsx)(Ye,{background:x.background,borderColor:x.border,padding:2,children:(0,e.jsx)(E.o,{fontWeight:"bold",textColor:x.text,children:n})}),(0,e.jsx)(A.a,{paddingLeft:2,paddingRight:2,children:ze()(l,m=>(0,e.jsxs)(E.o,{textColor:m.includes(":")?"neutral600":"neutral900",children:["/",m]},m))})]})]})}_.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},_.propTypes={route:O().shape({handler:O().string,method:O().string,path:O().string})};const we=_,Ze=()=>{const{formatMessage:t}=(0,S.A)(),{selectedAction:r,routes:n}=Z(),i=He()(r.split("."),"controllers"),g=X()(n,i[0]),l=i.slice(1).join("."),p=ke()(g)?[]:g.filter(f=>f.handler.endsWith(l));return(0,e.jsx)(P.E,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"},children:r?(0,e.jsx)(j.s,{direction:"column",alignItems:"stretch",gap:2,children:p.map((f,x)=>(0,e.jsx)(we,{route:f},x))}):(0,e.jsxs)(j.s,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(E.o,{variant:"delta",as:"h3",children:t({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})}),(0,e.jsx)(E.o,{as:"p",textColor:"neutral600",children:t({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"})})]})})},qe=(t,r,n)=>({...t,initialData:r,modifiedData:r,routes:n});var _e=s(48940),ue=s.n(_e),es=s(501),ss=s.n(es);const ts={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},ns=(t,r)=>(0,q.Ay)(t,n=>{switch(r.type){case"ON_CHANGE":{const i=r.keys.length,g=r.keys[i-1]==="enabled";if(r.value&&g){const l=ss()(r.keys,i-1).join(".");n.selectedAction=l}ue()(n,["modifiedData",...r.keys],r.value);break}case"ON_CHANGE_SELECT_ALL":{const i=["modifiedData",...r.keys],g=X()(t,i,{}),l=Object.keys(g).reduce((p,f)=>(p[f]={...g[f],enabled:r.value},p),{});ue()(n,i,l);break}case"ON_RESET":{n.modifiedData=t.initialData;break}case"ON_SUBMIT_SUCCEEDED":{n.initialData=t.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:i}=r;n.selectedAction=i===t.selectedAction?"":i;break}default:return n}}),ge=(0,a.forwardRef)(({permissions:t,routes:r},n)=>{const{formatMessage:i}=(0,S.A)(),[g,l]=(0,a.useReducer)(ns,ts,b=>qe(b,t,r));(0,a.useImperativeHandle)(n,()=>({getPermissions(){return{permissions:g.modifiedData}},resetForm(){l({type:"ON_RESET"})},setFormAfterSubmit(){l({type:"ON_SUBMIT_SUCCEEDED"})}}));const m={...g,onChange:({target:{name:b,value:D}})=>l({type:"ON_CHANGE",keys:b.split("."),value:D==="empty__string_value"?"":D}),onChangeSelectAll:({target:{name:b,value:D}})=>l({type:"ON_CHANGE_SELECT_ALL",keys:b.split("."),value:D}),onSelectedAction:b=>l({type:"SELECT_ACTION",actionToSelect:b})};return(0,e.jsx)(oe,{value:m,children:(0,e.jsxs)(B.x,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0",children:[(0,e.jsx)(P.E,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(j.s,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(j.s,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(E.o,{variant:"delta",as:"h2",children:i({id:(0,z.A)("Plugins.header.title"),defaultMessage:"Permissions"})}),(0,e.jsx)(E.o,{as:"p",textColor:"neutral600",children:i({id:(0,z.A)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."})})]}),(0,e.jsx)(Ie,{})]})}),(0,e.jsx)(Ze,{})]})})});ge.propTypes={permissions:O().object.isRequired,routes:O().object.isRequired};const he=(0,a.memo)(ge);var V=s(56914);const zs={isLoading:!0,modifiedData:{}},Qs=(t,r)=>produce(t,n=>{switch(r.type){case"GET_DATA":{n.isLoading=!0,n.modifiedData={};break}case"GET_DATA_SUCCEEDED":{n.isLoading=!1,n.modifiedData=r.data;break}case"GET_DATA_ERROR":{n.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{n.modifiedData=r.data;break}default:return n}}),Ks=null,Xs=(t,r)=>{const{isLoading:n,allowedActions:i}=useRBAC(r),[{isLoading:g,modifiedData:l},p]=useReducer(reducer,initialState),f=useNotification(),x=useRef(!0),{get:m}=useFetchClient();useEffect(()=>(n||(async()=>{try{p({type:"GET_DATA"});const{data:c}=await m(getRequestURL(t));p({type:"GET_DATA_SUCCEEDED",data:c})}catch(c){x.current&&(p({type:"GET_DATA_ERROR"}),console.error(c),f({type:"warning",message:{id:"notification.error"}}))}})(),()=>{x.current=!1}),[n,t,m,f]);const b=useCallback(D=>{p({type:"ON_SUBMIT_SUCCEEDED",data:D})},[]);return{allowedActions:i,dispatchSubmitSucceeded:b,isLoading:g,isLoadingForPermissions:n,modifiedData:l}},Ys=null,ws={roles:[],isLoading:!0},Zs=(t,r)=>produce(t,n=>{switch(r.type){case"GET_DATA":{n.isLoading=!0,n.roles=[];break}case"GET_DATA_SUCCEEDED":{n.roles=r.data,n.isLoading=!1;break}case"GET_DATA_ERROR":{n.isLoading=!1;break}default:return n}}),qs=null,_s=(t=!0)=>{const[{roles:r,isLoading:n},i]=useReducer(reducer,initialState,()=>init(initialState,t)),g=useNotification(),l=useRef(!0),p=useFetchClient(),f=useCallback(async()=>{try{i({type:"GET_DATA"});const{data:{roles:x}}=await p.get(`/${pluginId}/roles`);i({type:"GET_DATA_SUCCEEDED",data:x})}catch(x){const m=get(x,["response","payload","message"],"An error occured");l.current&&(i({type:"GET_DATA_ERROR"}),m!=="Forbidden"&&g({type:"warning",message:m}))}},[p,g]);return useEffect(()=>(t&&f(),()=>{l.current=!1}),[t,f]),{roles:r,isLoading:n,getData:f}},et=null;var ee=s(74930);const me=()=>{const t=(0,o.hN)(),{get:r}=(0,o.ry)(),{formatAPIError:n}=(0,o.wq)(V.gT),[{data:i,isLoading:g,error:l,refetch:p},{data:f,isLoading:x,error:m,refetch:b}]=(0,ee.useQueries)([{queryKey:[u.A,"permissions"],async queryFn(){return(await r(`/${u.A}/permissions`)).data.permissions}},{queryKey:[u.A,"routes"],async queryFn(){return(await r(`/${u.A}/routes`)).data.routes}}]),D=async()=>{await Promise.all([p(),b()])};(0,a.useEffect)(()=>{l&&t({type:"warning",message:n(l)})},[t,l,n]),(0,a.useEffect)(()=>{m&&t({type:"warning",message:n(m)})},[t,m,n]);const c=g||x;return{permissions:i?(0,V.mr)(i):{},routes:f??{},getData:D,isLoading:c}},os={role:{},isLoading:!0},rs=(t,r)=>(0,q.Ay)(t,n=>{switch(r.type){case"GET_DATA_SUCCEEDED":{n.role=r.role,n.isLoading=!1;break}case"GET_DATA_ERROR":{n.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{n.role.name=r.name,n.role.description=r.description;break}default:return n}}),is=t=>{const[r,n]=(0,a.useReducer)(rs,os),i=(0,o.hN)(),g=(0,a.useRef)(null),{get:l}=(0,o.ry)();(0,a.useEffect)(()=>(g.current=!0,t?p(t):n({type:"GET_DATA_SUCCEEDED",role:{}}),()=>g.current=!1),[t]);const p=async x=>{try{const{data:{role:m}}=await l(`/${u.A}/roles/${x}`);g.current&&n({type:"GET_DATA_SUCCEEDED",role:m})}catch(m){console.error(m),n({type:"GET_DATA_ERROR"}),i({type:"warning",message:{id:"notification.error"}})}},f=(0,a.useCallback)(x=>{n({type:"ON_SUBMIT_SUCCEEDED",...x})},[]);return{...r,onSubmitSucceeded:f}};var se=s(12083);const pe=se.Ik().shape({name:se.Yj().required(o.iW.required),description:se.Yj().required(o.iW.required)}),as=()=>{const{formatMessage:t}=(0,S.A)(),[r,n]=(0,a.useState)(!1),i=(0,o.hN)(),{goBack:g}=(0,d.W6)(),{lockApp:l,unlockApp:p}=(0,o.MA)(),{isLoading:f,permissions:x,routes:m}=me(),{trackUsage:b}=(0,o.z1)(),D=(0,a.useRef)(),{post:c}=(0,o.ry)(),G=async I=>{l(),n(!0);try{const U=D.current.getPermissions();await c(`/${u.A}/roles`,{...I,...U,users:[]}),b("didCreateRole"),i({type:"success",message:{id:(0,z.A)("Settings.roles.created"),defaultMessage:"Role created"}}),g()}catch(U){console.error(U),i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}n(!1),p()};return(0,e.jsxs)(y.g,{children:[(0,e.jsx)(o.x7,{name:"Roles"}),(0,e.jsx)($.l1,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:G,validationSchema:pe,children:({handleSubmit:I,values:U,handleChange:F,errors:W})=>(0,e.jsxs)(o.lV,{noValidate:!0,onSubmit:I,children:[(0,e.jsx)(R.Q,{primaryAction:!f&&(0,e.jsx)(T.$,{type:"submit",loading:r,startIcon:(0,e.jsx)(Q.A,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:t({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:t({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),(0,e.jsx)(v.s,{children:(0,e.jsxs)(j.s,{direction:"column",alignItems:"stretch",gap:7,children:[(0,e.jsx)(A.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(j.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(E.o,{variant:"delta",as:"h2",children:t({id:(0,z.A)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(B.x,{gap:4,children:[(0,e.jsx)(P.E,{col:6,children:(0,e.jsx)(M.k,{name:"name",value:U.name||"",onChange:F,label:t({id:"global.name",defaultMessage:"Name"}),error:W.name?t({id:W.name,defaultMessage:"Invalid value"}):null})}),(0,e.jsx)(P.E,{col:6,children:(0,e.jsx)(N.T,{id:"description",value:U.description||"",onChange:F,label:t({id:"global.description",defaultMessage:"Description"}),error:W.description?t({id:W.description,defaultMessage:"Invalid value"}):null})})]})]})}),!f&&(0,e.jsx)(he,{ref:D,permissions:x,routes:m})]})})]})})]})},ls=()=>(0,e.jsx)(o.kz,{permissions:h.J.createRole,children:(0,e.jsx)(as,{})});var cs=s(46270);const ds=()=>{const{formatMessage:t}=(0,S.A)(),[r,n]=(0,a.useState)(!1),i=(0,o.hN)(),{lockApp:g,unlockApp:l}=(0,o.MA)(),{params:{id:p}}=(0,d.W5)(`/settings/${u.A}/roles/:id`),{isLoading:f,routes:x}=me(),{role:m,onSubmitSucceeded:b,isLoading:D}=is(p),c=(0,a.useRef)(),{put:G}=(0,o.ry)(),I=async U=>{g(),n(!0);try{const F=c.current.getPermissions();await G(`/${u.A}/roles/${p}`,{...U,...F,users:[]}),b({name:U.name,description:U.description}),i({type:"success",message:{id:(0,z.A)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(F){console.error(F),i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}n(!1),l()};return D?(0,e.jsx)(o.Bl,{}):(0,e.jsxs)(y.g,{children:[(0,e.jsx)(o.x7,{name:"Roles"}),(0,e.jsx)($.l1,{enableReinitialize:!0,initialValues:{name:m.name,description:m.description},onSubmit:I,validationSchema:pe,children:({handleSubmit:U,values:F,handleChange:W,errors:H})=>(0,e.jsxs)(o.lV,{noValidate:!0,onSubmit:U,children:[(0,e.jsx)(R.Q,{primaryAction:!f&&(0,e.jsx)(T.$,{disabled:m.code==="strapi-super-admin",type:"submit",loading:r,startIcon:(0,e.jsx)(Q.A,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:m.name,subtitle:m.description,navigationAction:(0,e.jsx)(o.N_,{startIcon:(0,e.jsx)(cs.A,{}),to:"/settings/users-permissions/roles",children:t({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(v.s,{children:(0,e.jsxs)(j.s,{direction:"column",alignItems:"stretch",gap:7,children:[(0,e.jsx)(A.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(j.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(E.o,{variant:"delta",as:"h2",children:t({id:(0,z.A)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(B.x,{gap:4,children:[(0,e.jsx)(P.E,{col:6,children:(0,e.jsx)(M.k,{name:"name",value:F.name||"",onChange:W,label:t({id:"global.name",defaultMessage:"Name"}),error:H.name?t({id:H.name,defaultMessage:"Invalid value"}):null})}),(0,e.jsx)(P.E,{col:6,children:(0,e.jsx)(N.T,{id:"description",value:F.description||"",onChange:W,label:t({id:"global.description",defaultMessage:"Description"}),error:H.description?t({id:H.description,defaultMessage:"Invalid value"}):null})})]})]})}),!f&&(0,e.jsx)(he,{ref:c,permissions:m.permissions,routes:x})]})})]})})]})},us=()=>(0,e.jsx)(o.kz,{permissions:h.J.updateRole,children:(0,e.jsx)(ds,{})});var gs=s(82616),hs=s(52370),ms=s(7132),ps=s(81888),fs=s(40710),fe=s(99690),k=s(19692),xs=s(5194),ys=s(61152),xe=s(17060),js=s(41909),As=s(50612);const te=({sortedRoles:t,canDelete:r,permissions:n,setRoleToDelete:i,onDelete:g})=>{const{formatMessage:l}=(0,S.A)(),{push:p}=(0,d.W6)(),[f,x]=g,m=c=>r&&!["public","authenticated"].includes(c.type),b=c=>{i(c),x(!f)},D=c=>{p(`/settings/${u.A}/roles/${c}`)};return(0,e.jsx)(ys.N,{children:t?.map(c=>(0,e.jsxs)(fe.Tr,{...(0,o.qM)({fn:()=>D(c.id)}),children:[(0,e.jsx)(k.Td,{width:"20%",children:(0,e.jsx)(E.o,{children:c.name})}),(0,e.jsx)(k.Td,{width:"50%",children:(0,e.jsx)(E.o,{children:c.description})}),(0,e.jsx)(k.Td,{width:"30%",children:(0,e.jsx)(E.o,{children:`${c.nb_users} ${l({id:"global.users",defaultMessage:"users"}).toLowerCase()}`})}),(0,e.jsx)(k.Td,{children:(0,e.jsxs)(j.s,{justifyContent:"end",...o.dG,children:[(0,e.jsx)(o.d4,{permissions:n.updateRole,children:(0,e.jsx)(xe.K,{onClick:()=>D(c.id),noBorder:!0,icon:(0,e.jsx)(js.A,{}),label:l({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${c.name}`})})}),m(c)&&(0,e.jsx)(o.d4,{permissions:n.deleteRole,children:(0,e.jsx)(xe.K,{onClick:()=>b(c.id),noBorder:!0,icon:(0,e.jsx)(As.A,{}),label:l({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${c.name}`})})})]})})]},c.name))})},Rs=te;te.defaultProps={canDelete:!1},te.propTypes={onDelete:O().array.isRequired,permissions:O().object.isRequired,setRoleToDelete:O().func.isRequired,sortedRoles:O().array.isRequired,canDelete:O().bool};const vs=async(t,r)=>{try{const{get:n}=(0,o.GD)(),{data:i}=await n((0,V.X3)("roles"));return r("The roles have loaded successfully"),i}catch(n){throw t({type:"warning",message:{id:"notification.error"}}),new Error(n)}},Cs=async(t,r)=>{try{const{del:n}=(0,o.GD)();await n(`${(0,V.X3)("roles")}/${t}`)}catch{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}},Es=()=>{const{trackUsage:t}=(0,o.z1)(),{formatMessage:r,locale:n}=(0,S.A)(),{push:i}=(0,d.W6)(),g=(0,o.hN)(),{notifyStatus:l}=(0,gs.W)(),[{query:p}]=(0,o.sq)(),f=p?._q||"",[x,m]=(0,a.useState)(!1),[b,D]=(0,a.useState)(!1),[c,G]=(0,a.useState)();(0,o.L4)();const{isLoading:I,allowedActions:{canRead:U,canDelete:F}}=(0,o.ec)({create:h.J.createRole,read:h.J.readRoles,update:h.J.updateRole,delete:h.J.deleteRole}),{isLoading:W,data:{roles:H},isFetching:bs,refetch:Ls}=(0,ee.useQuery)("get-roles",()=>vs(g,l),{initialData:{},enabled:U}),{includes:ye}=(0,o.U2)(n,{sensitivity:"base"}),je=(0,o.QM)(n,{sensitivity:"base"}),Ae=W||bs,Ps=()=>{t("willCreateRole"),i(`/settings/${u.A}/roles/new`)},Ms=()=>{m(!x)},Ss={roles:{id:(0,V.gT)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,V.gT)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Os=r({id:"global.roles",defaultMessage:"Roles"}),Us=(0,ee.useMutation)(J=>Cs(J,g),{async onSuccess(){await Ls()}}),Bs=async()=>{D(!0),await Us.mutateAsync(c),m(!x),D(!1)},w=(H||[]).filter(J=>ye(J.name,f)||ye(J.description,f)).sort((J,Re)=>je.compare(J.name,Re.name)||je.compare(J.description,Re.description)),Ns=f&&!w.length?"search":"roles",$s=4,Gs=(H?.length||0)+1;return(0,e.jsxs)(hs.P,{children:[(0,e.jsx)(o.x7,{name:Os}),(0,e.jsxs)(y.g,{"aria-busy":Ae,children:[(0,e.jsx)(R.Q,{title:r({id:"global.roles",defaultMessage:"Roles"}),subtitle:r({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:(0,e.jsx)(o.d4,{permissions:h.J.createRole,children:(0,e.jsx)(T.$,{onClick:Ps,startIcon:(0,e.jsx)(xs.A,{}),size:"S",children:r({id:(0,V.gT)("List.button.roles"),defaultMessage:"Add new role"})})})}),(0,e.jsx)(ms.B,{startActions:(0,e.jsx)(o.q7,{label:r({id:"app.component.search.label",defaultMessage:"Search"})})}),(0,e.jsxs)(v.s,{children:[!U&&(0,e.jsx)(o.UW,{}),(Ae||I)&&(0,e.jsx)(o.Bl,{}),U&&w&&w?.length?(0,e.jsxs)(ps.X,{colCount:$s,rowCount:Gs,children:[(0,e.jsx)(fs.d,{children:(0,e.jsxs)(fe.Tr,{children:[(0,e.jsx)(k.Th,{children:(0,e.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:r({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(k.Th,{children:(0,e.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:r({id:"global.description",defaultMessage:"Description"})})}),(0,e.jsx)(k.Th,{children:(0,e.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:r({id:"global.users",defaultMessage:"Users"})})}),(0,e.jsx)(k.Th,{children:(0,e.jsx)(ae.s,{children:r({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,e.jsx)(Rs,{sortedRoles:w,canDelete:F,permissions:h.J,setRoleToDelete:G,onDelete:[x,m]})]}):(0,e.jsx)(o.pA,{content:Ss[Ns]})]}),(0,e.jsx)(o.TM,{isConfirmButtonLoading:b,onConfirm:Bs,onToggleDialog:Ms,isOpen:x})]})]})},Ts=()=>(0,e.jsx)(o.kz,{permissions:h.J.accessRoles,children:(0,e.jsx)(Es,{})}),Ds=()=>(0,e.jsx)(o.kz,{permissions:h.J.accessRoles,children:(0,e.jsxs)(d.dO,{children:[(0,e.jsx)(d.qh,{path:`/settings/${u.A}/roles/new`,component:ls,exact:!0}),(0,e.jsx)(d.qh,{path:`/settings/${u.A}/roles/:id`,component:us,exact:!0}),(0,e.jsx)(d.qh,{path:`/settings/${u.A}/roles`,component:Ts,exact:!0}),(0,e.jsx)(d.qh,{path:"",component:o.hH})]})})},56914:(C,L,s)=>{"use strict";s.d(L,{mr:()=>d,X3:()=>y,gT:()=>R.A});var e=s(77965),a=s.n(e);const d=T=>Object.keys(T).reduce((v,j)=>{const A=T[j].controllers,E=Object.keys(A).reduce((B,P)=>(a()(A[P])||(B[P]=A[P]),B),{});return a()(E)||(v[j]={controllers:E}),v},{});var h=s(4655);const y=T=>`/${h.A}/${T}`;var R=s(97552)},60759:(C,L,s)=>{var e=s(48143),a=s(83289),o=s(96685),d=s(87864),h=s(52689),u=s(37879),y=200;function R(T,v,j,A){var E=-1,B=a,P=!0,M=T.length,N=[],Q=v.length;if(!M)return N;j&&(v=d(v,h(j))),A?(B=o,P=!1):v.length>=y&&(B=u,P=!1,v=new e(v));e:for(;++E<M;){var $=T[E],S=j==null?$:j($);if($=A||$!==0?$:0,P&&S===S){for(var K=Q;K--;)if(v[K]===S)continue e;N.push($)}else B(v,S,A)||N.push($)}return N}C.exports=R},61468:(C,L,s)=>{var e=s(52196);function a(o){var d=o==null?0:o.length;return d?e(o,1,d):[]}C.exports=a},64958:(C,L,s)=>{var e=s(91662);function a(o,d){if(o!==d){var h=o!==void 0,u=o===null,y=o===o,R=e(o),T=d!==void 0,v=d===null,j=d===d,A=e(d);if(!v&&!A&&!R&&o>d||R&&T&&j&&!v&&!A||u&&T&&j||!h&&j||!y)return 1;if(!u&&!R&&!A&&o<d||A&&h&&y&&!u&&!R||v&&h&&y||!T&&y||!j)return-1}return 0}C.exports=a},74565:C=>{function L(s,e){var a=s.length;for(s.sort(e);a--;)s[a]=s[a].value;return s}C.exports=L},75821:(C,L,s)=>{var e=s(91522);function a(o,d){return function(h,u){if(h==null)return h;if(!e(h))return o(h,u);for(var y=h.length,R=d?y:-1,T=Object(h);(d?R--:++R<y)&&u(T[R],R,T)!==!1;);return h}}C.exports=a},97449:(C,L,s)=>{var e=s(85373),a=s(75821),o=a(e);C.exports=o}}]);
