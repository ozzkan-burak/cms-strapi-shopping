"use strict";(self.webpackChunkcms_strapi_shopping=self.webpackChunkcms_strapi_shopping||[]).push([[8754],{56914:(P,f,e)=>{e.d(f,{mr:()=>h,X3:()=>j,gT:()=>S.A});var t=e(77965),x=e.n(t);const h=l=>Object.keys(l).reduce((c,v)=>{const r=l[v].controllers,y=Object.keys(r).reduce((g,s)=>(x()(r[s])||(g[s]=r[s]),g),{});return x()(y)||(c[v]={controllers:y}),c},{});var p=e(4655);const j=l=>`/${p.A}/${l}`;var S=e(97552)},67385:(P,f,e)=>{e.r(f),e.d(f,{default:()=>X});var t=e(92132),x=e(21272),E=e(82616),h=e(49436),p=e(36531),T=e(82869),j=e(36726),S=e(52724),l=e(44940),c=e(12248),v=e(37750),r=e(23859),y=e(68114),g=e(65913),s=e(1433),I=e(54514),O=e(2506),D=e(54894),M=e(74930),F=e(69224),a=e(56914);const U=async()=>{const{get:i}=(0,s.GD)(),{data:o}=await i((0,a.X3)("advanced"));return o},G=i=>{const{put:o}=(0,s.GD)();return o((0,a.X3)("advanced"),i)},H=[{intlLabel:{id:(0,a.gT)("EditForm.inputToggle.label.email"),defaultMessage:"One account per email address"},description:{id:(0,a.gT)("EditForm.inputToggle.description.email"),defaultMessage:"Disallow the user to create multiple accounts using the same email address with different authentication providers."},name:"unique_email",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,a.gT)("EditForm.inputToggle.label.sign-up"),defaultMessage:"Enable sign-ups"},description:{id:(0,a.gT)("EditForm.inputToggle.description.sign-up"),defaultMessage:"When disabled (OFF), the registration process is forbidden. No one can subscribe anymore no matter the used provider."},name:"allow_register",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,a.gT)("EditForm.inputToggle.label.email-reset-password"),defaultMessage:"Reset password page"},description:{id:(0,a.gT)("EditForm.inputToggle.description.email-reset-password"),defaultMessage:"URL of your application's reset password page."},placeholder:{id:(0,a.gT)("EditForm.inputToggle.placeholder.email-reset-password"),defaultMessage:"ex: https://youtfrontend.com/reset-password"},name:"email_reset_password",type:"text",size:{col:6,xs:12}},{intlLabel:{id:(0,a.gT)("EditForm.inputToggle.label.email-confirmation"),defaultMessage:"Enable email confirmation"},description:{id:(0,a.gT)("EditForm.inputToggle.description.email-confirmation"),defaultMessage:"When enabled (ON), new registered users receive a confirmation email."},name:"email_confirmation",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,a.gT)("EditForm.inputToggle.label.email-confirmation-redirection"),defaultMessage:"Redirection url"},description:{id:(0,a.gT)("EditForm.inputToggle.description.email-confirmation-redirection"),defaultMessage:"After you confirmed your email, choose where you will be redirected."},placeholder:{id:(0,a.gT)("EditForm.inputToggle.placeholder.email-confirmation-redirection"),defaultMessage:"ex: https://youtfrontend.com/email-confirmation"},name:"email_confirmation_redirection",type:"text",size:{col:6,xs:12}}];var u=e(12083);const L=new RegExp("(^$)|((.+:\\/\\/.*)(d*)\\/?(.*))"),Q=u.Ik().shape({email_confirmation_redirection:u.gl().when("email_confirmation",{is:!0,then:u.Yj().matches(L).required(),otherwise:u.Yj().nullable()}),email_reset_password:u.Yj(s.iW.string).matches(L,s.iW.regex).nullable()}),W=()=>(0,t.jsx)(s.kz,{permissions:F.J.readAdvancedSettings,children:(0,t.jsx)(B,{})}),B=()=>{const{formatMessage:i}=(0,D.A)(),o=(0,s.hN)(),{lockApp:$,unlockApp:b}=(0,s.MA)(),{notifyStatus:w}=(0,E.W)(),Y=(0,M.useQueryClient)();(0,s.L4)();const{isLoading:J,allowedActions:{canUpdate:R}}=(0,s.ec)({update:F.J.updateAdvancedSettings}),{status:V,data:C}=(0,M.useQuery)("advanced",()=>U(),{onSuccess(){w(i({id:(0,a.gT)("Form.advancedSettings.data.loaded"),defaultMessage:"Advanced settings data has been loaded"}))},onError(){o({type:"warning",message:{id:(0,a.gT)("notification.error"),defaultMessage:"An error occured"}})}}),K=J||V!=="success",z=(0,M.useMutation)(d=>G(d),{async onSuccess(){await Y.invalidateQueries("advanced"),o({type:"success",message:{id:(0,a.gT)("notification.success.saved"),defaultMessage:"Saved"}}),b()},onError(){o({type:"warning",message:{id:(0,a.gT)("notification.error"),defaultMessage:"An error occured"}}),b()},refetchActive:!0}),{isLoading:Z}=z,k=async d=>{$();const m=d.email_confirmation?d.email_confirmation_redirection:"";await z.mutateAsync({...d,email_confirmation_redirection:m})};return K?(0,t.jsxs)(h.g,{"aria-busy":"true",children:[(0,t.jsx)(s.x7,{name:i({id:(0,a.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),(0,t.jsx)(p.Q,{title:i({id:(0,a.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),(0,t.jsx)(T.s,{children:(0,t.jsx)(s.Bl,{})})]}):(0,t.jsxs)(h.g,{"aria-busy":Z,children:[(0,t.jsx)(s.x7,{name:i({id:(0,a.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),(0,t.jsx)(O.l1,{onSubmit:k,initialValues:C.settings,validateOnChange:!1,validationSchema:Q,enableReinitialize:!0,children:({errors:d,values:m,handleChange:N,isSubmitting:q,dirty:_})=>(0,t.jsxs)(s.lV,{children:[(0,t.jsx)(p.Q,{title:i({id:(0,a.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"}),primaryAction:(0,t.jsx)(j.$,{loading:q,type:"submit",disabled:R?!_:!R,startIcon:(0,t.jsx)(I.A,{}),size:"S",children:i({id:"global.save",defaultMessage:"Save"})})}),(0,t.jsx)(T.s,{children:(0,t.jsx)(S.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,t.jsxs)(l.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsx)(c.o,{variant:"delta",as:"h2",children:i({id:"global.settings",defaultMessage:"Settings"})}),(0,t.jsxs)(v.x,{gap:6,children:[(0,t.jsx)(r.E,{col:6,s:12,children:(0,t.jsx)(y.l,{label:i({id:(0,a.gT)("EditForm.inputSelect.label.role"),defaultMessage:"Default role for authenticated users"}),value:m.default_role,hint:i({id:(0,a.gT)("EditForm.inputSelect.description.role"),defaultMessage:"It will attach the new authenticated user to the selected role."}),onChange:n=>N({target:{name:"default_role",value:n}}),children:C.roles.map(n=>(0,t.jsx)(g.c,{value:n.type,children:n.name},n.type))})}),H.map(n=>{let A=m[n.name];return A||(A=n.type==="bool"?!1:""),(0,t.jsx)(r.E,{...n.size,children:(0,t.jsx)(s.ah,{...n,value:A,error:d[n.name],disabled:n.name==="email_confirmation_redirection"&&m.email_confirmation===!1,onChange:N})},n.name)})]})]})})})]})})]})},X=W}}]);
